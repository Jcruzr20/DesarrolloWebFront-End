<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Cuenta - PolloAsado</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    .info-box {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
    }
    .points {
      font-size: 2rem;
      font-weight: bold;
      color: #198754;
    }
  </style>
</head>
<body class="bg-light">

  <!-- NAVBAR -->
  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <!-- Logo -->
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="https://cdn-icons-png.flaticon.com/512/1206/1206237.png" width="50" height="45" class="me-2">
        <h2 class="mb-0">PolloAsado</h2>
      </a>

      <div class="d-flex align-items-center">
        <a href="promociones.html" class="nav-link text-white me-4 fw-semibold">
          <i class="bi bi-megaphone-fill me-1"></i> Promociones
        </a>
        <a href="registroUsuario.html" class="nav-link text-white me-3">
          <i class="bi bi-person-circle" style="font-size:1.5rem;"></i>
        </a>
        <a href="Pedidos.html" class="nav-link text-white">
          <i class="bi bi-cart3" style="font-size:1.5rem;"></i>
        </a>
      </div>
    </div>
  </nav>

  <!-- CONTENIDO -->
  <div class="container mt-5 mb-5">
    <h2 class="text-center mb-4">Mi Cuenta</h2>

    <div class="row justify-content-center">
      <div class="col-md-6">

        <!-- Informaci√≥n del usuario -->
        <div class="info-box mb-4 shadow-sm">
          <i class="bi bi-person-lines-fill fs-1 text-dark"></i>

          <!-- üëá Aqu√≠ van los datos din√°micos -->
          <h4 class="mt-3">
            Bienvenido, <strong id="user-name">""</strong>
          </h4>
          <p class="text-muted mb-1">
            Correo: <span id="user-email">correo@example.com</span>
          </p>
          <p class="text-muted mb-1" id="email-status">
            Estado correo: (cargando...)
          </p>
          <p class="text-muted">Rol: Cliente</p>

          <!-- Botones de acci√≥n -->
          <a href="gestionPerfil.html" class="btn btn-outline-primary w-100 mt-3">
            <i class="bi bi-pencil-square me-2"></i> Modificar mis datos
          </a>
          <a href="reestablecer.html" class="btn btn-outline-primary w-100 mt-3">
            <i class="bi bi-key-fill me-2"></i> Reestablecer contrase√±a
          </a>

          <!-- Seguimiento de pedido -->
          <a href="seguimientoPedido.html" class="btn btn-primary w-100 mt-3">
            <i class="bi bi-truck me-2"></i> Seguimiento de pedido
          </a>
          <a href="verMisPedidos.html" class="btn btn-outline-primary w-100 mt-2">
            <i class="bi bi-box-seam me-1"></i> Mis pedidos
          </a>

        </div>

        <!-- Puntos acumulados -->
       <!-- Puntos acumulados -->
        <div class="info-box mb-4 shadow-sm">
          <h5>Puntos acumulados</h5>
          <p class="points">
            <span id="user-points">0</span> pts
          </p>
          <a href="canjearCupon.html" class="btn btn-success w-100 mb-2">
            <i class="bi bi-gift-fill me-2"></i> Canjear puntos
          </a>
          <a href="acumularPunto.html" class="btn btn-outline-success w-100">
            <i class="bi bi-plus-circle-fill me-2"></i> Acumular puntos
          </a>
        </div>


        <!-- Promociones y notificaciones -->
        <div class="info-box mb-4 shadow-sm">
          <h5>Promociones y Recompensas</h5>
          <div class="d-grid gap-2">
            <a href="promoPersonalizada.html" class="btn btn-primary">
              <i class="bi bi-stars me-2"></i> Ver promociones personalizadas
            </a>
            <a href="notificacion.html" class="btn btn-outline-primary">
              <i class="bi bi-bell-fill me-2"></i> Ver notificaciones
            </a>
          </div>
        </div>

        <!-- Cerrar sesi√≥n -->
        <div class="info-box shadow-sm">
          <!-- üëá ahora ser√° manejado por JS -->
          <button id="btn-logout" class="btn btn-danger w-100">
            <i class="bi bi-box-arrow-right me-2"></i> Cerrar sesi√≥n
          </button>
        </div>

      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="bg-black text-white mt-auto">
    <div class="container py-4">
      <div class="row">
        <div class="col-md-3 mb-3">
          <h4>PolloFast</h4>
          <img src="https://cdn-icons-png.flaticon.com/512/1206/1206237.png" width="50" height="45" class="me-2">
        </div>
        <div class="col-md-3 mb-3">
          <h6>Con√≥cenos</h6>
          <p class="mb-1">Tel√©fono</p>
          <p class="mb-1">Mail de contacto</p>
          <p class="mb-1">T√©rminos y condiciones</p>
          <p class="mb-0">Pol√≠tica de privacidad</p>
        </div>
        <div class="col-md-3 mb-3">
          <h6>Redes sociales</h6>
          <p class="mb-1"><i class="bi bi-instagram"></i> Instagram</p>
          <p class="mb-1"><i class="bi bi-facebook"></i> Facebook</p>
          <p class="mb-0"><i class="bi bi-twitter-x"></i> X</p>
        </div>
        <div class="col-md-3 mb-3">
          <h6>Mi cuenta</h6>
          <p class="mb-1">Pedir</p>
          <p class="mb-0">Iniciar sesi√≥n</p>
        </div>
      </div>
      <div class="text-center mt-3">
        <small><i class="bi bi-circle"></i></small>
      </div>
    </div>
  </footer>

  <!-- SCRIPT PERFIL -->

  <script>
    
      const API_BASE = "http://127.0.0.1:8000/api/pollosabroso";

      const nameSpan    = document.getElementById("user-name");
      const emailSpan   = document.getElementById("user-email");
      const emailStatus = document.getElementById("email-status");
      const pointsSpan  = document.getElementById("user-points");   // üëà NUEVO
      const logoutBtn   = document.getElementById("btn-logout");

      const token = localStorage.getItem("token");

      // Si no hay token, redirigir al login
      if (!token) {
        window.location.href = "registroUsuario.html";
      } else {
        cargarPerfil();
      }

      async function cargarPerfil() {
        try {
          const res = await fetch(`${API_BASE}/clientes/me`, {
            method: "GET",
            headers: {
              "Authorization": `Bearer ${token}`
            }
          });

          if (!res.ok) {
            emailStatus.textContent = "Error al cargar perfil. Inicia sesi√≥n nuevamente.";
            emailStatus.classList.add("text-danger");
            localStorage.removeItem("token");
            localStorage.removeItem("userEmail");
            setTimeout(() => {
              window.location.href = "registroUsuario.html";
            }, 1500);
            return;
          }

          const data = await res.json();
          console.log("Perfil cargado:", data);

          // Rellenar datos
          nameSpan.textContent  = data.name;
          emailSpan.textContent = data.email;

          if (data.emailVerified) {
            emailStatus.innerHTML = 'Estado correo: <span class="text-success fw-bold">verificado ‚úÖ</span>';
          } else {
            emailStatus.innerHTML = 'Estado correo: <span class="text-danger fw-bold">NO verificado ‚ùå</span>';
          }

          // üëá NUEVO: mostrar puntos reales
          if (pointsSpan) {
            pointsSpan.textContent = data.points ?? 0;
          }

        } catch (err) {
          console.error(err);
          emailStatus.textContent = "Error de conexi√≥n con el servidor.";
          emailStatus.classList.add("text-danger");
        }
      }

      // Cerrar sesi√≥n
      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("token");
        localStorage.removeItem("userEmail");
        window.location.href = "registroUsuario.html";
      });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
