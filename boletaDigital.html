<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boleta Digital | PolloAsado</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <!-- jsPDF (para generar el PDF) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body class="bg-light">

  <!-- NAVBAR -->
  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="https://cdn-icons-png.flaticon.com/512/1206/1206237.png" width="50" height="45" class="me-2">
        <h2 class="mb-0">PolloAsado</h2>
      </a>
      <div class="d-flex align-items-center">
        <a href="promociones.html" class="nav-link text-white me-4 fw-semibold">
          <i class="bi bi-megaphone-fill me-1"></i> Promociones
        </a>
        <a href="registroUsuario.html" class="nav-link text-white me-3">
          <i class="bi bi-person-circle" style="font-size:1.5rem;"></i>
        </a>
        <a href="Pedidos.html" class="nav-link text-white">
          <i class="bi bi-cart3" style="font-size:1.5rem;"></i>
        </a>
      </div>
    </div>
  </nav>

  <!-- CONTENIDO -->
  <div class="container mt-5 text-center">
    <h2>Boleta Digital</h2>
    <p class="text-muted">Tu boleta fue generada correctamente.</p>

    <div id="boletaOk" class="alert alert-success p-4">
      <i class="bi bi-file-earmark-pdf-fill" style="font-size:2rem;"></i>
      <h4 class="mt-2">¬°Boleta disponible!</h4>
      <p>Puedes descargar tu boleta en formato PDF.</p>
      <button id="btnDescargar" class="btn btn-danger">
        <i class="bi bi-download"></i> Descargar Boleta
      </button>
    </div>

    <div id="boletaError" class="alert alert-danger p-4 d-none">
      <i class="bi bi-exclamation-triangle-fill" style="font-size:2rem;"></i>
      <h4 class="mt-2">Error al generar boleta</h4>
      <p>No se pudo generar tu boleta autom√°ticamente.</p>
      <a href="confirmacionPago.html" class="btn btn-warning">
        <i class="bi bi-arrow-left"></i> Volver
      </a>
    </div>
  </div>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>

  <!-- FOOTER -->
  <footer class="bg-black text-white mt-auto mt-5">
    <div class="container py-4">
      <div class="row">
        <div class="col-md-3 mb-3">
          <h4>PolloFast</h4>
          <img src="https://cdn-icons-png.flaticon.com/512/1206/1206237.png" width="50" height="45" class="me-2">
        </div>
        <div class="col-md-3 mb-3">
          <h6>Con√≥cenos</h6>
          <p>Tel√©fono</p><p>Mail de contacto</p><p>T√©rminos y condiciones</p>
        </div>
        <div class="col-md-3 mb-3">
          <h6>Redes sociales</h6>
          <p><i class="bi bi-instagram"></i> Instagram</p>
          <p><i class="bi bi-facebook"></i> Facebook</p>
          <p><i class="bi bi-twitter-x"></i> X</p>
        </div>
      </div>
      <div class="text-center mt-3">
        <small><i class="bi bi-circle"></i></small>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- SCRIPT PDF -->
  <script>
    const { jsPDF } = window.jspdf;

    document.getElementById("btnDescargar").addEventListener("click", generarBoletaPDF);

    function generarBoletaPDF() {
      const datosPago = JSON.parse(localStorage.getItem("ultimoPago"));
      if (!datosPago) {
        document.getElementById("boletaOk").classList.add("d-none");
        document.getElementById("boletaError").classList.remove("d-none");
        return;
      }

      const doc = new jsPDF();
      const fecha = new Date().toLocaleString();
      const idBoleta = "BA-" + Math.floor(Math.random() * 1000000);
      let y = 40;
      let total = 0;

      // Encabezado
      doc.setFontSize(20);
      doc.text("Pollo Asado Ltda.", 105, 20, { align: "center" });
      doc.setFontSize(11);
      doc.text("RUT: 11.111.111-1 | Direcci√≥n: Av. Las Delicias 1234 | Santiago, Chile", 105, 28, { align: "center" });
      doc.text("Boleta N¬∞ " + idBoleta, 15, 38);
      doc.text("Fecha: " + fecha, 140, 38);
      doc.line(15, 42, 195, 42);

      // Detalle
      doc.setFontSize(13);
      doc.text("Detalle del Pedido", 15, 50);
      y = 58;

      datosPago.carrito.forEach(pedido => {
        doc.setFontSize(12);
        doc.text("‚Ä¢ " + pedido.plato, 15, y);
        y += 6;

        pedido.items.forEach(item => {
          const precio = parseInt(item.nombre.match(/\$(\d+)/)?.[1] || 0);
          total += precio * item.cantidad;
          doc.setFontSize(11);
          doc.text(`   - ${item.nombre} x${item.cantidad}`, 20, y);
          y += 6;
        });
        y += 4;
      });

      doc.line(15, y, 195, y);
      y += 10;

      // Totales
      doc.setFontSize(13);
      doc.text(`Total: $${total.toLocaleString("es-CL")}`, 160, y, { align: "right" });
      y += 10;
      doc.text(`M√©todo de pago: ${datosPago.metodo}`, 15, y);

      // Pie
      y += 20;
      doc.setFontSize(10);
      doc.text("Gracias por tu compra üçó", 105, y, { align: "center" });
      y += 5;
      doc.text("www.polloasado.cl | contacto@polloasado.cl", 105, y, { align: "center" });

      // Descargar
      doc.save(`Boleta_PolloAsado_${idBoleta}.pdf`);

      // Limpia despu√©s de generar
      localStorage.removeItem("ultimoPago");
    }
  </script>

</body>
</html>
